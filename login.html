<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Tranzit — Вход</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body class="layout">
  <header class="layout__header">
    <div class="logo">Tranzit</div>
  </header>
  <main class="layout__content">
    <form id="loginForm" class="card card--form">
      <h1>Вход</h1>
      <input class="input" type="text" name="login" placeholder="Email или телефон" required>
      <input class="input" type="password" name="password" placeholder="Пароль" required>
      <button class="button button--primary" type="submit">Войти</button>
      <div class="form__footer">
        <a href="#" class="link">Забыли пароль?</a>
        <a href="/register">Регистрация</a>
      </div>
      <div class="alert" id="loginErrors" style="display:none"></div>
    </form>
  </main>
  <script type="module">
    import { initSupabaseClient } from './supabase.js';
    const supabase = initSupabaseClient();

    document.getElementById('loginForm').onsubmit = async (e) => {
      e.preventDefault();
      const f = e.target;
      const login = f.login.value.trim();
      const password = f.password.value;
      const errorBox = document.getElementById('loginErrors');
      errorBox.style.display = 'none';

      // Определение формата (email/телефон)
      let email = login;
      if (/^\+7\s\d{3}\s\d{3}-\d{2}-\d{2}$/.test(login)) {
        // Заглушка: Преобразовать телефон в email, если есть такой функционал.
        errorBox.innerText = "Для входа используйте Email. Поддержка по телефону в разработке.";
        errorBox.style.display = 'block';
        return;
      }

      const { error, data, session } = await supabase.auth.signInWithPassword({ email, password });
      if (error) {
        errorBox.innerText = error.message;
        errorBox.style.display = 'block';
      } else {
        location.href = '/home';
      }
    };
  </script>
</body>
</html>
